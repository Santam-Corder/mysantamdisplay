<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Development Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --declined-color: #6c7a89;
            --light-gray: #ecf0f1;
            --dark-gray: #7f8c8d;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --chart-bg: #f8f9fa;
            --bg-color: #f5f7fa;
            --text-color: #333;
            --sidebar-bg: #2c3e50;
            --sidebar-text: rgba(255, 255, 255, 0.8);
            --card-bg: white;
            --gradient-primary: linear-gradient(135deg, #3498db, #2c3e50);
            --gradient-success: linear-gradient(135deg, #2ecc71, #27ae60);
            --gradient-warning: linear-gradient(135deg, #f39c12, #e67e22);
            --gradient-danger: linear-gradient(135deg, #e74c3c, #c0392b);
            --gradient-declined: linear-gradient(135deg, #6c7a89, #4a5568);
            --sales-color: #f39c12;
            --commercial-color: #e74c3c;
            --technical-color: #3498db;
        }

        /* Dark mode variables */
        .dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #f0f0f0;
            --sidebar-bg: #121212;
            --sidebar-text: rgba(255, 255, 255, 0.8);
            --card-bg: #2d2d2d;
            --light-gray: #444;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --chart-bg: #2d2d2d;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .dashboard-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            padding: 20px 0;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            transition: var(--transition);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        
        .sidebar-header h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }
        
        .sidebar-header h2 i {
            color: var(--primary-color);
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 5px;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            color: var(--sidebar-text);
            text-decoration: none;
            transition: var(--transition);
            position: relative;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .sidebar-menu a::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: var(--gradient-primary);
            transition: var(--transition);
            z-index: 0;
        }
        
        .sidebar-menu a:hover::before, .sidebar-menu a.active::before {
            width: 4px;
        }
        
        .sidebar-menu a i {
            width: 20px;
            text-align: center;
            z-index: 1;
        }
        
        /* Main Content Styles */
        .main-content {
            padding: 20px;
            overflow-y: auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .header h1 {
            color: var(--secondary-color);
            font-size: 1.8rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 20px;
            transition: var(--transition);
        }
        
        .user-profile:hover {
            background: rgba(52, 152, 219, 0.2);
            transform: translateY(-2px);
        }
        
        .user-profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-color);
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }
        
        .stat-card.success::before {
            background: var(--gradient-success);
        }
        
        .stat-card.warning::before {
            background: var(--gradient-warning);
        }
        
        .stat-card.danger::before {
            background: var(--gradient-danger);
        }
        
        .stat-card.declined::before {
            background: var(--gradient-declined);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .stat-icon.primary {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary-color);
        }
        
        .stat-icon.success {
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--success-color);
        }
        
        .stat-icon.warning {
            background-color: rgba(243, 156, 18, 0.1);
            color: var(--warning-color);
        }
        
        .stat-icon.danger {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
        }
        
        .stat-icon.declined {
            background-color: rgba(108, 122, 137, 0.1);
            color: var(--declined-color);
        }
        
        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .stat-info p {
            color: var(--dark-gray);
            font-size: 0.9rem;
        }
        
        .dashboard-section {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            padding: 25px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .dashboard-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            opacity: 0.7;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .section-header h2 {
            color: var(--secondary-color);
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            background-color: var(--light-gray);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .filter-btn:hover {
            background-color: #e0e0e0;
        }
        
        .filter-btn.active {
            background: var(--gradient-primary);
            color: white;
        }
        
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .project-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: var(--transition);
            border-left: 4px solid var(--primary-color);
            display: flex;
            flex-direction: column;
        }
        
        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .project-card.urgent {
            border-left-color: var(--danger-color);
        }
        
        .project-card.warning {
            border-left-color: var(--warning-color);
        }
        
        .project-card.completed {
            border-left-color: var(--success-color);
        }
        
        .project-card.declined {
            border-left-color: var(--declined-color);
        }
        
        /* PROJECT TEXT SIZE INCREASED - REMOVED GAP */
        .project-card h3 {
            margin-top: 0;
            color: var(--secondary-color);
            font-size: 1.4rem;
            margin-bottom: 10px; /* Reduced from 15px */
            font-weight: 600;
            line-height: 1.2; /* Added to reduce spacing */
        }
        
        .project-info {
            display: flex;
            flex-direction: column;
            gap: 8px; /* Reduced from 12px */
            margin: 10px 0; /* Reduced from 15px 0 */
            flex-grow: 1;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
        }
        
        .info-label {
            font-weight: 600;
            color: var(--dark-gray);
            font-size: 0.9rem;
        }
        
        .info-value {
            color: var(--secondary-color);
            text-align: right;
            font-size: 0.9rem;
        }
        
        /* Deadline text in project info - RED AND BOLD */
        .deadline-text {
            font-weight: bold !important;
            color: #e74c3c !important; /* Red color */
        }
        
        .progress-container {
            margin: 10px 0; /* Reduced from 15px 0 */
        }
        
        .progress-bar {
            height: 8px;
            background-color: var(--light-gray);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .progress {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .progress.urgent {
            background-color: var(--danger-color);
        }
        
        .progress.warning {
            background-color: var(--warning-color);
        }
        
        .progress.completed {
            background-color: var(--success-color);
        }
        
        .progress.declined {
            background-color: var(--declined-color);
        }
        
        /* DEADLINE STYLES - Keep as original */
        .deadline {
            font-weight: bold;
            margin: 8px 0; /* Reduced from 10px 0 */
            padding: 8px;
            border-radius: 5px;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .deadline.urgent {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
        }
        
        .deadline.warning {
            background-color: rgba(243, 156, 18, 0.1);
            color: var(--warning-color);
        }
        
        .deadline.normal {
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--success-color);
        }
        
        .deadline.declined {
            background-color: rgba(108, 122, 137, 0.1);
            color: var(--declined-color);
        }

        .countdown {
            font-family: monospace;
            font-size: 0.85rem;
            text-align: center;
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
            background-color: rgba(0, 0, 0, 0.03);
            color: var(--secondary-color);
        }
        
        .countdown.urgent {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
        }
        
        .countdown.warning {
            background-color: rgba(243, 156, 18, 0.1);
            color: var(--warning-color);
        }
        
        .countdown.declined {
            background-color: rgba(108, 122, 137, 0.1);
            color: var(--declined-color);
        }
        
        .team-members {
            margin-top: 10px; /* Reduced from 15px */
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .team-member {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            width: 70px;
        }
        
        .member-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--light-gray);
            transition: var(--transition);
        }
        
        .member-avatar:hover {
            transform: scale(1.1);
            border-color: var(--primary-color);
        }
        
        .member-info {
            text-align: center;
            width: 100%;
        }
        
        .member-name {
            font-size: 0.7rem;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .member-role {
            font-size: 0.6rem;
            color: var(--dark-gray);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .project-status {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .status-active {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary-color);
        }
        
        .status-completed {
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--success-color);
        }
        
        .status-declined {
            background-color: rgba(108, 122, 137, 0.1);
            color: var(--declined-color);
        }
        
        .status-delayed {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
        }
        
        .project-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px; /* Reduced from 20px */
            padding-top: 12px; /* Reduced from 15px */
            border-top: 1px solid var(--light-gray);
            justify-content: center;
        }
        
        .project-action-btn {
            background: none;
            border: none;
            color: var(--dark-gray);
            cursor: pointer;
            font-size: 0.9rem;
            padding: 8px 15px;
            border-radius: 20px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            min-width: 100px;
        }
        
        .project-action-btn:hover {
            color: white;
        }
        
        .project-action-btn.edit {
            background-color: var(--light-gray);
        }
        
        .project-action-btn.edit:hover {
            background: var(--gradient-primary);
            color: white;
        }
        
        .project-action-btn.delete {
            background-color: var(--light-gray);
        }
        
        .project-action-btn.delete:hover {
            background: var(--gradient-danger);
            color: white;
        }
        
        .time-display {
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--gradient-primary);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
        }
        
        .clock {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .date {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* Team Section Styles - ALL TEAM MEMBERS TOGETHER */
        .team-section {
            margin-top: 30px;
        }
        
        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .team-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .team-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }
        
        .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .team-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--light-gray);
        }
        
        /* TEAM AVATAR COLORS BY DEPARTMENT */
        .team-avatar.sales {
            border-color: var(--sales-color) !important;
        }
        
        .team-avatar.commercial {
            border-color: var(--commercial-color) !important;
        }
        
        .team-avatar.technical {
            border-color: var(--technical-color) !important;
        }
        
        .team-details {
            text-align: center;
        }
        
        .team-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .team-position {
            color: var(--dark-gray);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .team-department {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.75rem;
        }
        
        /* Department-specific colors */
        .team-department.sales {
            background-color: rgba(243, 156, 18, 0.1);
            color: var(--sales-color);
        }
        
        .team-department.commercial {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--commercial-color);
        }
        
        .team-department.technical {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--technical-color);
        }
        
        /* REMOVED Department Headers since all teams are together */
        
        /* Charts Section - VERY BIG CHARTS */
        .charts-section {
            margin-top: 30px;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        
        /* Modified chart cards for full width */
        .chart-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            padding: 30px; /* Increased padding */
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 550px; /* Set minimum height */
        }
        
        .chart-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .chart-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }
        
        .chart-title {
            color: var(--secondary-color);
            margin-bottom: 25px; /* Increased margin */
            font-size: 1.5rem; /* Increased font size */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .chart-title i {
            color: var(--primary-color);
            font-size: 1.3rem; /* Increased icon size */
        }
        
        /* VERY BIG CHART CONTAINER */
        .chart-container {
            position: relative;
            height: 550px !important; /* Force height to be bigger */
            width: 100% !important;
            flex-grow: 1;
        }
        
        /* Make the canvas itself bigger */
        .chart-container canvas {
            width: 100% !important;
            height: 100% !important;
            max-height: 550px !important;
        }
        
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background-color: var(--card-bg);
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .modal-header h3 {
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-modal {
            font-size: 28px;
            cursor: pointer;
            color: var(--dark-gray);
            transition: var(--transition);
        }
        
        .close-modal:hover {
            color: var(--danger-color);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        .form-group input[type="text"],
        .form-group input[type="date"],
        .form-group input[type="time"],
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 1rem;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .team-selection {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .team-member-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .team-member-checkbox:hover {
            background-color: rgba(52, 152, 219, 0.1);
            border-color: var(--primary-color);
        }
        
        .team-member-checkbox input[type="checkbox"] {
            margin: 0;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--light-gray);
        }
        
        .cancel-btn,
        .submit-btn,
        .update-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }
        
        .cancel-btn {
            background-color: var(--light-gray);
            color: var(--text-color);
        }
        
        .submit-btn,
        .update-btn {
            background: var(--gradient-success);
            color: white;
        }
        
        .cancel-btn:hover {
            background-color: var(--dark-gray);
            color: white;
        }
        
        .submit-btn:hover,
        .update-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        #project-progress {
            width: 100%;
            margin: 10px 0;
        }
        
        #progress-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Responsive styles */
        @media (max-width: 1200px) {
            .charts-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .chart-container {
                height: 500px !important; /* Bigger on medium screens */
            }
            
            .chart-card {
                min-height: 500px;
            }
        }
        
        @media (max-width: 992px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
                height: auto;
            }
            
            .projects-grid, .team-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 450px !important; /* Still big on tablets */
            }
            
            .chart-card {
                min-height: 450px;
                padding: 25px;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .filter-controls {
                flex-wrap: wrap;
            }
            
            .time-display {
                margin-top: 15px;
                width: 100%;
                justify-content: center;
            }
            
            .project-actions {
                flex-direction: column;
            }
            
            .project-action-btn {
                width: 100%;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .chart-card {
                padding: 20px;
                min-height: 400px;
            }
            
            .chart-container {
                height: 400px !important; /* Big on mobile */
            }
        }
        
        @media (max-width: 576px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .projects-grid, .team-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-card {
                padding: 15px;
                min-height: 350px;
            }
            
            .chart-container {
                height: 350px !important; /* Big even on small mobile */
            }
            
            .charts-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-chart-line"></i> BID Dashboard</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" class="active"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="#projects-section"><i class="fas fa-project-diagram"></i> Projects</a></li>
                <li><a href="#team-section"><i class="fas fa-users"></i> Team</a></li>
                <li><a href="#charts-section"><i class="fas fa-chart-pie"></i> Analytics</a></li>
                <!-- Removed Settings and Help sections -->
            </ul>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <div class="header">
                <h1>BIDS AND SUBMISSION DASHBOARD</h1>
                <div class="user-profile">
                    <img src="https://ui-avatars.com/api/?name=Santam+Sharma&background=3498db&color=fff" alt="User">
                    <span>Santam Sharma</span>
                </div>
            </div>
            
            <!-- Stats Overview -->
            <div class="stats-container">
                <div class="stat-card primary">
                    <div class="stat-icon primary">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-projects">0</h3>
                        <p>Total Projects</p>
                    </div>
                </div>
                <div class="stat-card success">
                    <div class="stat-icon success">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="completed-projects">0</h3>
                        <p>Completed</p>
                    </div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-icon warning">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="active-projects">0</h3>
                        <p>Active</p>
                    </div>
                </div>
                <div class="stat-card danger">
                    <div class="stat-icon danger">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="urgent-projects">0</h3>
                        <p>Urgent</p>
                    </div>
                </div>
                <div class="stat-card declined">
                    <div class="stat-icon declined">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="declined-projects">0</h3>
                        <p>Declined</p>
                    </div>
                </div>
            </div>
            
            <!-- Time Display -->
            <div class="time-display">
                <div class="clock" id="realtime-clock">00:00:00</div>
                <div class="date" id="current-date">Monday, January 1, 2023</div>
            </div>
            
            <!-- Projects Section -->
            <div class="dashboard-section" id="projects-section">
                <div class="section-header">
                    <h2><i class="fas fa-project-diagram"></i> Current Projects</h2>
                    <div class="filter-controls">
                        <button class="filter-btn active" data-filter="all">All Projects</button>
                        <button class="filter-btn" data-filter="active">Active</button>
                        <button class="filter-btn" data-filter="completed">Completed</button>
                        <button class="filter-btn" data-filter="declined">Declined</button>
                        <button class="filter-btn" data-filter="urgent">Priority</button>
                    </div>
                    <button id="add-project-btn" class="filter-btn" style="background: var(--gradient-success); color: white;">
                        <i class="fas fa-plus"></i> Add Project
                    </button>
                </div>
                
                <div class="projects-grid" id="projects-container">
                    <!-- Projects will be added dynamically by JavaScript -->
                </div>
            </div>
            
            <!-- Team Section - ALL TEAM MEMBERS TOGETHER -->
            <div class="dashboard-section team-section" id="team-section">
                <div class="section-header">
                    <h2><i class="fas fa-users"></i> Our Team</h2>
                </div>
                
                <div class="team-grid" id="team-container">
                    <!-- Team members will be added dynamically by JavaScript -->
                </div>
            </div>
            
            <!-- Charts Section - MOVED BELOW TEAM -->
            <div class="dashboard-section charts-section" id="charts-section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-pie"></i> Project Analytics</h2>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <h3 class="chart-title"><i class="fas fa-chart-pie"></i> Project Status Distribution</h3>
                        <div class="chart-container">
                            <canvas id="pieChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <h3 class="chart-title"><i class="fas fa-project-diagram"></i> Project Urgency Overview</h3>
                        <div class="chart-container">
                            <canvas id="doughnutChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Project Modal -->
    <div id="project-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus"></i> <span id="modal-title">Add New Project</span></h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="project-form">
                    <input type="hidden" id="project-id">
                    
                    <div class="form-group">
                        <label for="project-name">Project Name *</label>
                        <input type="text" id="project-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="project-lead">Project Lead *</label>
                        <select id="project-lead" required>
                            <option value="">Select Lead</option>
                            <!-- Options will be populated from teamMembers -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="deadline">Deadline *</label>
                        <input type="date" id="deadline" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="deadline-time">Deadline Time</label>
                        <input type="time" id="deadline-time" value="23:59">
                    </div>
                    
                    <div class="form-group">
                        <label for="project-status">Status *</label>
                        <select id="project-status" required>
                            <option value="active">In Progress</option>
                            <option value="completed">Completed</option>
                            <option value="declined">Declined</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="project-team">Team Members</label>
                        <div class="team-selection" id="team-selection">
                            <!-- Team members will be added here -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="project-progress">Progress (%)</label>
                        <input type="range" id="project-progress" min="0" max="100" value="0">
                        <span id="progress-value">0%</span>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="cancel-btn">Cancel</button>
                        <button type="submit" class="submit-btn" id="form-submit-btn">Add Project</button>
                    </div>
                </form>
            </div>
        </div>
</div>

    <script>
        // Team data with photos and designations - REMOVED ISMA GHAFFAR
        const teamMembers = [
            {
                id: 11,
                name: "Kartik Shankar Narayan",
                position: "Chief Sales Officer",
                department: "Sales",
                avatar: "https://ui-avatars.com/api/?name=Kartik+Shankar+Narayan&background=f39c12&color=fff&bold=true&size=128"
            },
            {
                id: 1,
                name: "Amine Boukhris",
                position: "Business Development Manager",
                department: "Sales",
                avatar: "https://ui-avatars.com/api/?name=Amine+Boukhris&background=f39c12&color=fff"
            },
            {
                id: 2,
                name: "Sama Lavala",
                position: "Business Development Executive",
                department: "Sales",
                avatar: "https://ui-avatars.com/api/?name=Sama+Lavala&background=f39c12&color=fff"
            },
            {
                id: 9,
                name: "Bensin Oommen",
                position: "Sales Asst. Manager",
                department: "Sales",
                avatar: "https://ui-avatars.com/api/?name=Bensin+Oommen&background=f39c12&color=fff"
            },
            {
                id: 10,
                name: "Sales",
                position: "Sales Department",
                department: "Sales",
                avatar: "https://ui-avatars.com/api/?name=Sales+Team&background=f39c12&color=fff"
            },
            {
                id: 3,
                name: "Vimal Raj",
                position: "Commercial Manager",
                department: "Commercial",
                avatar: "https://ui-avatars.com/api/?name=Vimal+Raj&background=e74c3c&color=fff"
            },
            {
                id: 6,
                name: "Aseel Bader",
                position: "Commercial Asst. Manager",
                department: "Commercial",
                avatar: "https://ui-avatars.com/api/?name=Assel+Bader&background=e74c3c&color=fff"
            },
            {
                id: 7,
                name: "Mohamed Midlaj",
                position: "Bid Engineer",
                department: "Commercial",
                avatar: "https://ui-avatars.com/api/?name=Mew+Member&background=e74c3c&color=fff"
            },
            {
                id: 4,
                name: "Santam Sharma",
                position: "BID and Technical Administrator",
                department: "Technical",
                avatar: "https://ui-avatars.com/api/?name=Santam+Sharma&background=3498db&color=fff"
            },
            {
                id: 5,
                name: "Astrid Dalgado",
                position: "BID Manager",
                department: "Technical",
                avatar: "https://ui-avatars.com/api/?name=Astrid+Dalgado&background=3498db&color=fff"
            },
            {
                id: 8,
                name: "Rafia Rahat",
                position: "Bid Administrator",
                department: "Technical",
                avatar: "https://ui-avatars.com/api/?name=Rafia+Rahat&background=3498db&color=fff"
            }
        ];

        // Current user (for team filtering)
        const currentUser = {
            id: 4, // Santam Sharma
            name: "Santam Sharma",
            department: "Technical"
        };

        // Project data with team member IDs
        let projects = [
            {
                id: 1,
                title: "DAEP Security",
                status: "active",
                deadline: "2026-01-06",
                deadlineTime: "16:00",
                lead: "Amine Boukhris",
                leadId: 1,
                progress: 70,
                team: [4]
            },
            {
                id: 2,
                title: "Dubai Future Foundation",
                status: "active",
                deadline: "2026-01-09",
                deadlineTime: "12:00",
                lead: "Bensin Oommen",
                leadId: 9,
                progress: 50,
                team: []
            },
            {
                id: 3,
                title: "Millennium Hotels IFM",
                status: "completed",
                deadline: "2025-12-03",
                deadlineTime: "15:00",
                lead: "Amine Boukhris",
                leadId: 1,
                progress: 100,
                team: [4, 9]
            },
            {
                id: 4,
                title: "AWR Zone 1 IFM",
                status: "completed",
                deadline: "2025-12-25",
                deadlineTime: "18:00",
                lead: "Santam Sharma",
                leadId: 4,
                progress: 100,
                team: [3, 4, 5, 8]
            },
            {
                id: 5,
                title: "Burj Khalifa",
                status: "completed",
                deadline: "2025-10-07",
                deadlineTime: "23:59",
                lead: "Sama Lavala",
                leadId: 2,
                progress: 100,
                team: [5, 4, 8]
            },
            {
                id: 6,
                title: "ARADA",
                status: "completed",
                deadline: "2025-12-10",
                deadlineTime: "18:00",
                lead: "Bensin Oommen",
                leadId: 9,
                progress: 100,
                team: [4, 9, 3]
            },
            {
                id: 7,
                title: "Core Prime",
                status: "declined",
                deadline: "2025-12-10",
                deadlineTime: "23:30",
                lead: "Vimal Raj",
                leadId: 3,
                progress: 30,
                team: [4, 6]
            },
            {
                id: 8,
                title: "ADEO",
                status: "completed",
                deadline: "2025-12-19",
                deadlineTime: "14:00",
                lead: "Astrid Dalgado",
                leadId: 5,
                progress: 100,
                team: [4, 5, 7, 9]
            },
            {
                id: 9,
                title: "Rufescent Hotels",
                status: "completed",
                deadline: "2025-10-07",
                lead: "Amine Boukhris",
                leadId: 1,
                progress: 100,
                team: [4]
            },
            {
                id: 10,
                title: "New Project Example",
                status: "active",
                deadline: "2026-02-01",
                lead: "Santam Sharma",
                leadId: 4,
                progress: 30,
                team: [4, 5, 8]
            }
        ];

        // Function to get team member by ID
        function getTeamMember(id) {
            return teamMembers.find(member => member.id === id);
        }

        // Function to render team members ALL TOGETHER
        function renderTeam() {
            const container = document.getElementById('team-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Sort team members by name (all together, no department headers)
            const sortedTeamMembers = [...teamMembers].sort((a, b) => a.name.localeCompare(b.name));
            
            sortedTeamMembers.forEach(member => {
                const teamCard = document.createElement('div');
                teamCard.className = 'team-card';
                
                // Determine department class
                const deptClass = member.department.toLowerCase();
                
                teamCard.innerHTML = `
                    <img src="${member.avatar}" alt="${member.name}" class="team-avatar ${deptClass}">
                    <div class="team-details">
                        <h4 class="team-name">${member.name}</h4>
                        <p class="team-position">${member.position}</p>
                        <span class="team-department ${deptClass}">${member.department}</span>
                    </div>
                `;
                
                container.appendChild(teamCard);
            });
        }

        // Function to update stats counters
        function updateStats() {
            const total = projects.length;
            const completed = projects.filter(p => p.status === 'completed').length;
            const active = projects.filter(p => p.status === 'active').length;
            const declined = projects.filter(p => p.status === 'declined').length;
            
            // For urgent, we'll need to calculate based on deadlines
            const now = new Date();
            let urgent = 0;
            
            projects.forEach(project => {
                if (project.status === 'active') {
                    const deadline = createDeadlineDateTime(project.deadline, project.deadlineTime || "23:59");
                    const diffTime = deadline - now;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays <= 3 && diffTime > 0) {
                        urgent++;
                    }
                }
            });
            
            // Update main stats
            document.getElementById('total-projects').textContent = total;
            document.getElementById('completed-projects').textContent = completed;
            document.getElementById('active-projects').textContent = active;
            document.getElementById('urgent-projects').textContent = urgent;
            document.getElementById('declined-projects').textContent = declined;
            
            // Update charts
            updateCharts(total, completed, active, declined, urgent);
        }

        // Function to render all projects sorted by deadline
        function renderProjects(filterTeam = null) {
            const container = document.getElementById('projects-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Sort projects by deadline (ascending order)
            const sortedProjects = [...projects].sort((a, b) => {
                const dateA = createDeadlineDateTime(a.deadline, a.deadlineTime || "23:59");
                const dateB = createDeadlineDateTime(b.deadline, b.deadlineTime || "23:59");
                return dateA - dateB;
            });
            
            sortedProjects.forEach(project => {
                // Skip projects that don't belong to the filtered team
                if (filterTeam) {
                    if (filterTeam === 'my-team' && !project.team.includes(currentUser.id)) {
                        return;
                    } else if (filterTeam !== 'my-team' && filterTeam !== 'all') {
                        const teamMembersInProject = project.team.map(id => getTeamMember(id));
                        if (!teamMembersInProject.some(member => member && member.department.toLowerCase() === filterTeam)) {
                            return;
                        }
                    }
                }
                
                const projectEl = document.createElement('div');
                projectEl.className = `project-card ${getProjectCardClass(project)}`;
                projectEl.setAttribute('data-status', project.status);
                projectEl.setAttribute('data-deadline', project.deadline);
                if (project.deadlineTime) {
                    projectEl.setAttribute('data-deadline-time', project.deadlineTime);
                }
                projectEl.setAttribute('data-id', project.id);
                
                let statusClass = 'status-active';
                let statusText = 'In Progress';
                if (project.status === 'completed') {
                    statusClass = 'status-completed';
                    statusText = 'Completed';
                } else if (project.status === 'declined') {
                    statusClass = 'status-declined';
                    statusText = 'Declined';
                } else if (isProjectUrgent(project)) {
                    statusClass = 'status-delayed';
                    statusText = 'Urgent';
                }
                
                // Get lead information
                const lead = getTeamMember(project.leadId);
                const leadName = lead ? lead.name : project.lead;
                
                // Generate team member avatars
                const teamAvatars = project.team.map(memberId => {
                    const member = getTeamMember(memberId);
                    if (!member) return '';
                    const deptClass = member.department.toLowerCase();
                    return `
                        <div class="team-member">
                            <img src="${member.avatar}" alt="${member.name}" class="member-avatar ${deptClass}">
                            <div class="member-info">
                                <div class="member-name">${member.name.split(' ')[0]}</div>
                                <div class="member-role">${member.department}</div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                projectEl.innerHTML = `
                    <span class="project-status ${statusClass}">${statusText}</span>
                    <h3>${project.title}</h3>
                    
                    <div class="project-info">
                        <div class="info-item">
                            <span class="info-label">Project Lead:</span>
                            <span class="info-value">${leadName}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Deadline:</span>
                            <span class="info-value deadline-text">${formatDateForDisplay(project.deadline)}${project.deadlineTime ? ' at ' + formatTimeForDisplay(project.deadlineTime) : ''}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Progress:</span>
                            <span class="info-value" id="progress-${project.id}">${project.progress}%</span>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress ${getProgressClass(project)}" id="progress-bar-${project.id}" style="width: ${project.progress}%"></div>
                        </div>
                    </div>
                    
                    ${project.status !== 'declined' ? `
                        <div class="countdown" id="countdown-${project.id}">
                            Calculating countdown...
                        </div>
                        
                        <div class="deadline" id="deadline-${project.id}">
                            Calculating...
                        </div>
                    ` : ''}
                    
                    ${project.team && project.team.length > 0 ? `
                        <div class="team-members">
                            ${teamAvatars}
                        </div>
                    ` : ''}
                    
                    <div class="project-actions">
                        <button class="project-action-btn edit" data-id="${project.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="project-action-btn delete" data-id="${project.id}">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                
                container.appendChild(projectEl);
            });
            
            updateProjectDeadlines(new Date());
            updateStats();
            
            // Add event listeners for edit and delete buttons
            addProjectActionListeners();
        }

        // Function to add event listeners to project action buttons
        function addProjectActionListeners() {
            // Add event listeners for edit buttons
            document.querySelectorAll('.project-action-btn.edit').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const projectId = parseInt(btn.getAttribute('data-id'));
                    editProject(projectId);
                });
            });
            
            // Add event listeners for delete buttons
            document.querySelectorAll('.project-action-btn.delete').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const projectId = parseInt(btn.getAttribute('data-id'));
                    if (confirm('Are you sure you want to delete this project?')) {
                        deleteProject(projectId);
                    }
                });
            });
        }

        // Function to delete a project
        function deleteProject(projectId) {
            const index = projects.findIndex(p => p.id === projectId);
            if (index !== -1) {
                projects.splice(index, 1);
                renderProjects();
                alert('Project deleted successfully!');
            }
        }

        // Function to edit a project
        function editProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) {
                console.error('Project not found with ID:', projectId);
                return;
            }
            
            // Set modal title
            document.getElementById('modal-title').textContent = 'Edit Project';
            document.getElementById('form-submit-btn').textContent = 'Update Project';
            
            // Fill form with project data
            document.getElementById('project-id').value = project.id;
            document.getElementById('project-name').value = project.title;
            
            // Populate team leads dropdown first
            const leadSelect = document.getElementById('project-lead');
            leadSelect.innerHTML = '<option value="">Select Lead</option>';
            teamMembers.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = member.name;
                leadSelect.appendChild(option);
            });
            
            // Now set the selected value
            document.getElementById('project-lead').value = project.leadId;
            
            // Set deadline and time
            document.getElementById('deadline').value = project.deadline;
            document.getElementById('deadline-time').value = project.deadlineTime || '23:59';
            
            // Set status and progress
            document.getElementById('project-status').value = project.status;
            document.getElementById('project-progress').value = project.progress;
            document.getElementById('progress-value').textContent = `${project.progress}%`;
            
            // Populate team members selection
            const teamSelection = document.getElementById('team-selection');
            teamSelection.innerHTML = '';
            teamMembers.forEach(member => {
                const label = document.createElement('label');
                label.className = 'team-member-checkbox';
                const isChecked = project.team && project.team.includes(member.id);
                label.innerHTML = `
                    <input type="checkbox" value="${member.id}" ${isChecked ? 'checked' : ''}>
                    <span>${member.name.split(' ')[0]}</span>
                `;
                teamSelection.appendChild(label);
            });
            
            // Show modal
            showProjectModal();
        }

        // Helper function to get progress bar class
        function getProgressClass(project) {
            if (project.status === 'completed') return 'completed';
            if (project.status === 'declined') return 'declined';
            if (isProjectUrgent(project)) return 'urgent';
            if (isProjectWarning(project)) return 'warning';
            return '';
        }

        // Helper function to determine project card class
        function getProjectCardClass(project) {
            if (project.status === 'completed') return 'completed';
            if (project.status === 'declined') return 'declined';
            if (isProjectUrgent(project)) return 'urgent';
            if (isProjectWarning(project)) return 'warning';
            return '';
        }

        // Helper function to check if project is urgent
        function isProjectUrgent(project) {
            if (project.status === 'completed' || project.status === 'declined') return false;
            
            const deadline = createDeadlineDateTime(project.deadline, project.deadlineTime || "23:59");
            const diffTime = deadline - new Date();
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            return diffDays <= 3 && diffTime > 0;
        }

        // Helper function to check if project is in warning state
        function isProjectWarning(project) {
            if (project.status === 'completed' || project.status === 'declined') return false;
            
            const deadline = createDeadlineDateTime(project.deadline, project.deadlineTime || "23:59");
            const diffTime = deadline - new Date();
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            return diffDays <= 7 && diffDays > 3 && diffTime > 0;
        }

        // Helper function to format date for display
        function formatDateForDisplay(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        // Helper function to format time for display
        function formatTimeForDisplay(timeStr) {
            if (!timeStr) return '';
            const [hours, minutes] = timeStr.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        }

        // Create full deadline datetime
        function createDeadlineDateTime(deadlineStr, timeStr) {
            // Default to end of day if no time specified
            if (!timeStr) timeStr = "23:59";
            
            const [year, month, day] = deadlineStr.split('-');
            const [hours, minutes] = timeStr.split(':');
            
            return new Date(year, month - 1, day, hours, minutes, 0);
        }

        // Update real-time clock
        function updateClock() {
            const now = new Date();
            
            // Update time
            const timeString = now.toLocaleTimeString();
            document.getElementById('realtime-clock').textContent = timeString;
            
            // Update date
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateString = now.toLocaleDateString(undefined, options);
            document.getElementById('current-date').textContent = dateString;
            
            // Update all project deadlines and countdowns
            updateProjectDeadlines(now);
        }
        
        function updateProjectDeadlines(now) {
            const projectElements = document.querySelectorAll('.project-card');
            
            projectElements.forEach(project => {
                const deadlineStr = project.getAttribute('data-deadline');
                const deadlineTime = project.getAttribute('data-deadline-time');
                const deadline = createDeadlineDateTime(deadlineStr, deadlineTime);
                const status = project.getAttribute('data-status');
                const projectId = project.getAttribute('data-id');
                
                if (!projectId || status === 'declined') return;
                
                const countdownElement = document.getElementById(`countdown-${projectId}`);
                const deadlineElement = document.getElementById(`deadline-${projectId}`);
                const progressBar = document.getElementById(`progress-bar-${projectId}`);
                
                if (!countdownElement || !deadlineElement) return;
                
                // Calculate time remaining
                const diffTime = deadline - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                // Calculate countdown (days, hours, minutes, seconds)
                let countdownText = '';
                let countdownClass = '';
                let deadlineText = '';
                let deadlineClass = '';
                
                if (status === 'completed') {
                    countdownText = 'Completed';
                    countdownClass = 'normal';
                    deadlineText = 'Completed';
                    deadlineClass = 'normal';
                } else if (diffTime <= 0) {
                    countdownText = 'Deadline passed';
                    countdownClass = 'urgent';
                    deadlineText = `Overdue by ${Math.abs(diffDays)} days`;
                    deadlineClass = 'urgent';
                } else {
                    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                    const diffHours = Math.floor((diffTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const diffMinutes = Math.floor((diffTime % (1000 * 60 * 60)) / (1000 * 60));
                    const diffSeconds = Math.floor((diffTime % (1000 * 60)) / 1000);
                    
                    if (diffDays > 0) {
                        countdownText = `${diffDays}d ${diffHours}h ${diffMinutes}m`;
                    } else {
                        countdownText = `${diffHours}h ${diffMinutes}m ${diffSeconds}s`;
                    }
                    
                    if (diffDays <= 3) {
                        countdownClass = 'urgent';
                        deadlineClass = 'urgent';
                        deadlineText = `Due in ${diffDays} days`;
                    } else if (diffDays <= 7) {
                        countdownClass = 'warning';
                        deadlineClass = 'warning';
                        deadlineText = `Due in ${diffDays} days`;
                    } else {
                        countdownClass = 'normal';
                        deadlineClass = 'normal';
                        deadlineText = `Due in ${diffDays} days`;
                    }
                }
                
                // Update countdown display
                countdownElement.textContent = countdownText;
                countdownElement.className = `countdown ${countdownClass}`;
                
                // Update deadline display - Keep as original
                deadlineElement.textContent = deadlineText;
                deadlineElement.className = `deadline ${deadlineClass}`;
                
                // Update project card class for urgent/warning
                project.classList.remove('urgent', 'warning');
                if (deadlineClass === 'urgent') {
                    project.classList.add('urgent');
                } else if (deadlineClass === 'warning') {
                    project.classList.add('warning');
                }
                
                // Update progress bar color if overdue
                if (progressBar) {
                    if (diffTime <= 0 && status !== 'completed') {
                        progressBar.style.backgroundColor = 'var(--danger-color)';
                    }
                }
            });
        }
        
        // Chart functions with numbers and percentages - BIGGER CHARTS
        function updateCharts(total, completed, active, declined, urgent) {
            // Destroy existing charts if they exist
            if (window.pieChartInstance) window.pieChartInstance.destroy();
            if (window.doughnutChartInstance) window.doughnutChartInstance.destroy();
            
            // Calculate percentages for pie chart
            const completedPercent = total > 0 ? Math.round((completed / total) * 100) : 0;
            const activePercent = total > 0 ? Math.round(((active - urgent) / total) * 100) : 0;
            const declinedPercent = total > 0 ? Math.round((declined / total) * 100) : 0;
            
            // Pie Chart - Project Status with numbers and percentages
            const pieCtx = document.getElementById('pieChart');
            if (pieCtx) {
                window.pieChartInstance = new Chart(pieCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: [
                            `Completed: ${completed} (${completedPercent}%)`,
                            `Active: ${active - urgent} (${activePercent}%)`,
                            `Declined: ${declined} (${declinedPercent}%)`
                        ],
                        datasets: [{
                            data: [completed, active - urgent, declined],
                            backgroundColor: [
                                'rgba(46, 204, 113, 0.8)',
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(108, 122, 137, 0.8)'
                            ],
                            borderColor: [
                                'rgba(46, 204, 113, 1)',
                                'rgba(52, 152, 219, 1)',
                                'rgba(108, 122, 137, 1)'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false, // Changed to false for better control
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    font: {
                                        size: 18 // Much bigger text
                                    },
                                    padding: 30, // More spacing
                                    usePointStyle: true,
                                    pointStyle: 'circle',
                                    boxWidth: 20,
                                    boxHeight: 20
                                }
                            },
                            tooltip: {
                                bodyFont: {
                                    size: 16 // Bigger tooltip text
                                },
                                titleFont: {
                                    size: 16
                                },
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const percentage = Math.round((value / total) * 100);
                                        return `${label.split(':')[0]}: ${value} (${percentage}%)`;
                                    }
                                }
                            },
                            datalabels: {
                                display: true,
                                color: '#fff',
                                font: {
                                    size: 20, // Much bigger data labels
                                    weight: 'bold'
                                },
                                formatter: function(value, context) {
                                    const percentage = Math.round((value / total) * 100);
                                    return `${value}\n(${percentage}%)`;
                                }
                            }
                        },
                        animation: {
                            animateScale: true,
                            animateRotate: true
                        },
                        layout: {
                            padding: {
                                top: 40,
                                bottom: 40,
                                left: 40,
                                right: 40
                            }
                        }
                    },
                    plugins: [ChartDataLabels]
                });
            }
            
            // Doughnut Chart - Project Urgency with numbers and percentages
            const doughnutCtx = document.getElementById('doughnutChart');
            if (doughnutCtx) {
                const onTrack = projects.filter(p => {
                    if (p.status === 'completed' || p.status === 'declined') return false;
                    const deadline = createDeadlineDateTime(p.deadline, p.deadlineTime || "23:59");
                    const diffTime = deadline - new Date();
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    return diffDays > 7 && diffTime > 0;
                }).length;
                
                const warning = projects.filter(p => {
                    if (p.status === 'completed' || p.status === 'declined') return false;
                    const deadline = createDeadlineDateTime(p.deadline, p.deadlineTime || "23:59");
                    const diffTime = deadline - new Date();
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    return diffDays <= 7 && diffDays > 3 && diffTime > 0;
                }).length;
                
                const urgentCount = projects.filter(p => {
                    if (p.status === 'completed' || p.status === 'declined') return false;
                    const deadline = createDeadlineDateTime(p.deadline, p.deadlineTime || "23:59");
                    const diffTime = deadline - new Date();
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    return diffDays <= 3 && diffTime > 0;
                }).length;
                
                const overdue = projects.filter(p => {
                    if (p.status === 'completed' || p.status === 'declined') return false;
                    const deadline = createDeadlineDateTime(p.deadline, p.deadlineTime || "23:59");
                    return deadline < new Date();
                }).length;
                
                const completedDeclined = projects.filter(p => p.status === 'completed' || p.status === 'declined').length;
                
                // Calculate percentages
                const onTrackPercent = total > 0 ? Math.round((onTrack / total) * 100) : 0;
                const warningPercent = total > 0 ? Math.round((warning / total) * 100) : 0;
                const urgentPercent = total > 0 ? Math.round((urgentCount / total) * 100) : 0;
                const overduePercent = total > 0 ? Math.round((overdue / total) * 100) : 0;
                const completedDeclinedPercent = total > 0 ? Math.round((completedDeclined / total) * 100) : 0;
                
                window.doughnutChartInstance = new Chart(doughnutCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: [
                            `On Track: ${onTrack} (${onTrackPercent}%)`,
                            `Warning: ${warning} (${warningPercent}%)`,
                            `Urgent: ${urgentCount} (${urgentPercent}%)`,
                            `Overdue: ${overdue} (${overduePercent}%)`,
                            `Completed/Declined: ${completedDeclined} (${completedDeclinedPercent}%)`
                        ],
                        datasets: [{
                            data: [onTrack, warning, urgentCount, overdue, completedDeclined],
                            backgroundColor: [
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(243, 156, 18, 0.8)',
                                'rgba(231, 76, 60, 0.8)',
                                'rgba(155, 89, 182, 0.8)',
                                'rgba(108, 122, 137, 0.8)'
                            ],
                            borderColor: [
                                'rgba(52, 152, 219, 1)',
                                'rgba(243, 156, 18, 1)',
                                'rgba(231, 76, 60, 1)',
                                'rgba(155, 89, 182, 1)',
                                'rgba(108, 122, 137, 1)'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false, // Changed to false
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    font: {
                                        size: 18 // Much bigger text
                                    },
                                    padding: 30, // More spacing
                                    usePointStyle: true,
                                    pointStyle: 'circle',
                                    boxWidth: 20,
                                    boxHeight: 20
                                }
                            },
                            tooltip: {
                                bodyFont: {
                                    size: 16 // Bigger tooltip text
                                },
                                titleFont: {
                                    size: 16
                                },
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const percentage = Math.round((value / total) * 100);
                                        return `${label.split(':')[0]}: ${value} (${percentage}%)`;
                                    }
                                }
                            },
                            datalabels: {
                                display: true,
                                color: '#fff',
                                font: {
                                    size: 20, // Much bigger data labels
                                    weight: 'bold'
                                },
                                formatter: function(value, context) {
                                    const percentage = Math.round((value / total) * 100);
                                    return `${value}\n(${percentage}%)`;
                                }
                            }
                        },
                        cutout: '50%', // Smaller hole for bigger doughnut
                        animation: {
                            animateScale: true,
                            animateRotate: true
                        },
                        layout: {
                            padding: {
                                top: 40,
                                bottom: 40,
                                left: 40,
                                right: 40
                            }
                        }
                    },
                    plugins: [ChartDataLabels]
                });
            }
        }
        
        // Function to show project modal (for both add and edit)
        function showProjectModal() {
            const modal = document.getElementById('project-modal');
            modal.style.display = 'flex';
            
            // Update progress value display
            const progressSlider = document.getElementById('project-progress');
            const progressValue = document.getElementById('progress-value');
            
            progressSlider.addEventListener('input', function() {
                progressValue.textContent = `${this.value}%`;
            });
        }

        // Function to close modal
        function closeProjectModal() {
            const modal = document.getElementById('project-modal');
            modal.style.display = 'none';
            document.getElementById('project-form').reset();
            document.getElementById('progress-value').textContent = '0%';
            document.getElementById('modal-title').textContent = 'Add New Project';
            document.getElementById('form-submit-btn').textContent = 'Add Project';
            document.getElementById('project-id').value = '';
        }

        // Function to add or update project
        function saveProject(event) {
            event.preventDefault();
            
            const projectId = document.getElementById('project-id').value;
            const name = document.getElementById('project-name').value;
            const leadId = parseInt(document.getElementById('project-lead').value);
            const deadline = document.getElementById('deadline').value;
            const deadlineTime = document.getElementById('deadline-time').value;
            const status = document.getElementById('project-status').value;
            const progress = parseInt(document.getElementById('project-progress').value);
            
            // Get selected team members
            const selectedTeam = [];
            document.querySelectorAll('#team-selection input[type="checkbox"]:checked').forEach(checkbox => {
                selectedTeam.push(parseInt(checkbox.value));
            });
            
            // Get lead name
            const lead = teamMembers.find(m => m.id === leadId);
            const leadName = lead ? lead.name : 'Unknown';
            
            if (projectId) {
                // Update existing project
                const index = projects.findIndex(p => p.id === parseInt(projectId));
                if (index !== -1) {
                    projects[index] = {
                        ...projects[index],
                        title: name,
                        status: status,
                        deadline: deadline,
                        deadlineTime: deadlineTime,
                        lead: leadName,
                        leadId: leadId,
                        progress: progress,
                        team: selectedTeam
                    };
                }
            } else {
                // Create new project object
                const newProject = {
                    id: projects.length > 0 ? Math.max(...projects.map(p => p.id)) + 1 : 1,
                    title: name,
                    status: status,
                    deadline: deadline,
                    deadlineTime: deadlineTime,
                    lead: leadName,
                    leadId: leadId,
                    progress: progress,
                    team: selectedTeam
                };
                
                // Add to projects array
                projects.push(newProject);
            }
            
            // Re-render projects
            renderProjects();
            
            // Close modal
            closeProjectModal();
            
            // Show success message
            alert(`Project ${projectId ? 'updated' : 'added'} successfully!`);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize the dashboard
            renderProjects();
            renderTeam();
            updateClock();
            
            // Filter projects
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.getAttribute('data-filter')) {
                    btn.addEventListener('click', () => {
                        // Update active button
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        const filter = btn.getAttribute('data-filter');
                        const projectCards = document.querySelectorAll('.project-card');
                        
                        projectCards.forEach(project => {
                            const status = project.getAttribute('data-status');
                            const isUrgent = project.classList.contains('urgent');
                            const isCompleted = status === 'completed';
                            const isDeclined = status === 'declined';
                            const isActive = status === 'active';
                            
                            let shouldShow = false;
                            
                            if (filter === 'all') {
                                shouldShow = true;
                            } else if (filter === 'active' && isActive) {
                                shouldShow = true;
                            } else if (filter === 'completed' && isCompleted) {
                                shouldShow = true;
                            } else if (filter === 'declined' && isDeclined) {
                                shouldShow = true;
                            } else if (filter === 'urgent' && isUrgent) {
                                shouldShow = true;
                            }
                            
                            project.style.display = shouldShow ? 'block' : 'none';
                        });
                    });
                }
            });
            
            // Add project button event listener
            document.getElementById('add-project-btn').addEventListener('click', () => {
                // Reset modal for adding new project
                document.getElementById('modal-title').textContent = 'Add New Project';
                document.getElementById('form-submit-btn').textContent = 'Add Project';
                document.getElementById('project-id').value = '';
                document.getElementById('project-form').reset();
                document.getElementById('progress-value').textContent = '0%';
                
                // Populate team leads dropdown
                const leadSelect = document.getElementById('project-lead');
                leadSelect.innerHTML = '<option value="">Select Lead</option>';
                teamMembers.forEach(member => {
                    const option = document.createElement('option');
                    option.value = member.id;
                    option.textContent = member.name;
                    leadSelect.appendChild(option);
                });
                
                // Populate team members selection
                const teamSelection = document.getElementById('team-selection');
                teamSelection.innerHTML = '';
                teamMembers.forEach(member => {
                    const label = document.createElement('label');
                    label.className = 'team-member-checkbox';
                    label.innerHTML = `
                        <input type="checkbox" value="${member.id}">
                        <span>${member.name.split(' ')[0]}</span>
                    `;
                    teamSelection.appendChild(label);
                });
                
                // Set default deadline to 30 days from now
                const futureDate = new Date();
                futureDate.setDate(futureDate.getDate() + 30);
                const futureDateStr = futureDate.toISOString().split('T')[0];
                document.getElementById('deadline').value = futureDateStr;
                
                // Show modal
                showProjectModal();
            });
            
            // Modal close events
            document.querySelector('.close-modal').addEventListener('click', closeProjectModal);
            document.querySelector('.cancel-btn').addEventListener('click', closeProjectModal);
            
            // Form submission
            document.getElementById('project-form').addEventListener('submit', saveProject);
            
            // Close modal when clicking outside
            document.getElementById('project-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeProjectModal();
                }
            });
            
            // Update clock every second
            setInterval(updateClock, 1000);
        });
    </script>
</body>
</html>
